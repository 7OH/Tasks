
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Объект.Дата = ТекущаяДата();
	//Павлюков
	ДатаОкончания = Объект.Дата;
	
	Если Параметры.Свойство("Задача") Тогда 
		Объект.Задача = Параметры.Задача;
	КонецЕсли;
	
	Если Параметры.Свойство("Исполнитель") Тогда 
		Объект.Исполнитель = Параметры.Исполнитель;
	КонецЕсли;
	
	Спринт = Справочники.узСпринты.ПолучитьТекущийСпринтДляЗадачи(КонецДня(Объект.Дата), Объект.Задача);
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	
	ЗаполнитьРеквизитыЗадачиНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьРеквизитыЗадачиНаСервере()
	
	СтрокаДанных = Объект.Данные.Добавить();
	СтрокаДанных.Спринт = Спринт;
	СтрокаДанных.ДатаНачала = ДатаНачала;
	СтрокаДанных.ДатаОкончания = ДатаОкончания;
	СтрокаДанных.Факт = Факт;
	СтрокаДанных.Примечание = Примечание;
	
КонецПроцедуры

&НаКлиенте
Процедура ФактПриИзменении(Элемент)
	
	Если Не ЗначениеЗаполнено(ДатаНачала) Тогда
		
		ДатаНачала = ДатаОкончания - Факт * 3600;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)
	Оповестить("узВводФактаПоЗадачеЗаписан");
КонецПроцедуры
